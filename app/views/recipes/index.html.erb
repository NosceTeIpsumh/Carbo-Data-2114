<% content_for :navabr_text_label, "My CarboMeals" %>
<% content_for :navbar_text_path, root_path %>

<div class="container">
  <div class="shadow-sm rounded-5 mt-4 p-4 segment-control-bar">
    <%= link_to 'Carbomeals', recipes_path, class: "segment-button #{'active' if current_page?(recipes_path)}" %>
    <%= link_to 'Carboducts', items_path, class: "segment-button #{'active' if current_page?(items_path)}" %>
  </div>

  <%
    carousels = [
      { id: 'carousel1', title: 'Low GI recipes', recipes: @low_gi_recipes, level: 'low' },
      { id: 'carousel2', title: 'Med GI recipes', recipes: @medium_gi_recipes, level: 'medium' },
      { id: 'carousel3', title: 'High GI recipes', recipes: @high_gi_recipes, level: 'high' }
    ]
  %>

  <% carousels.each do |carousel| %>
    <div class="carousel-section mt-4">
      <h2 class="h-default mb-3">
        <span class="recipe-count recipe-count-<%= carousel[:level] %>">
          <i class="bi bi-book-fill"></i>
          <span class="count-number"><%= carousel[:recipes].count %></span>
        </span>
        <%= carousel[:title] %>
      </h2>
      <div id="<%= carousel[:id] %>" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
          <% carousel[:recipes].each_with_index do |recipe, index| %>
            <div class="carousel-item <%= 'active' if index == 0 %>">
              <div class="recipe-card">
                <div class="recipe-card-image" style="background-image: url('https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=500&h=750&fit=crop');">
                  <div class="recipe-card-badges">
                    <div class="gi-badge gi-<%= recipe.gi_level %>">
                      <i class="bi bi-droplet-fill"></i>
                      <span><%= recipe.indice_gly %></span>
                    </div>
                    <div class="carb-badge carb-<%= recipe.gi_level %>">
                      <i class="bi bi-lightning-charge-fill"></i>
                      <span><%= recipe.ratio_glucide %>g</span>
                    </div>
                  </div>
                  <div class="recipe-card-content">
                    <h3><%= recipe.name %></h3>
                    <div class="recipe-ratings">
                      <div class="rating-item">
                        <span class="rating-label">GI:</span>
                        <div class="rating-stars"><%= '★' * recipe.gi_stars + '☆' * (5 - recipe.gi_stars) %></div>
                      </div>
                      <div class="rating-item">
                        <span class="rating-label">Glucides:</span>
                        <div class="rating-stars"><%= '★' * recipe.carb_stars + '☆' * (5 - recipe.carb_stars) %></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>

        <button class="carousel-control-prev" type="button" data-bs-target="#<%= carousel[:id] %>" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#<%= carousel[:id] %>" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
        </button>

        <div class="carousel-indicators hub-carousel-indicators">
          <% carousel[:recipes].each_with_index do |_, index| %>
            <button type="button" data-bs-target="#<%= carousel[:id] %>" data-bs-slide-to="<%= index %>"
                    class="<%= 'active' if index == 0 %>" <%= 'aria-current="true"' if index == 0 %>></button>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<div class="offcanvas offcanvas-end", tabindex="-1", id="offcanvasAction", aria-labelledby="offcanvasActionLabel">
  <div class="offcanvas-dialog offcanvas-dialog-centered">
    <div class="offcanvas-content">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title p-default" id="offcanvasActionLabel">Add a New CarboMeal</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <%= render "form", recipe: @recipe %>
      </div>
    </div>
  </div>
</div>
